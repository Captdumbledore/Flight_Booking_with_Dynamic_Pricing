<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flight Booking System - Dynamic Pricing</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --navy-blue: #001f3f;
            --light-navy: #003366;
            --accent-blue: #0074D9;
            --light-blue: #7FDBFF;
            --white: #ffffff;
            --light-gray: #f5f7fa;
            --text-dark: #2c3e50;
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--navy-blue) 0%, var(--light-navy) 100%);
            min-height: 100vh;
            color: var(--text-dark);
        }

        /* Header */
        .header {
            background: var(--navy-blue);
            color: var(--white);
            padding: 1.5rem 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo span {
            color: var(--light-blue);
        }

        .nav-menu {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-menu a {
            color: var(--white);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
            cursor: pointer;
        }

        .nav-menu a:hover {
            color: var(--light-blue);
        }

        /* Container */
        .container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, rgba(0, 116, 217, 0.9), rgba(0, 31, 63, 0.95)), 
                        url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 600"><rect fill="%23001f3f" width="1200" height="600"/><path fill="%23003366" d="M0 400 Q300 350 600 400 T1200 400 V600 H0 Z"/></svg>');
            background-size: cover;
            padding: 3rem 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            color: var(--white);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .hero h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .hero p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        /* Search Card */
        .search-card {
            background: var(--white);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        .search-card h2 {
            color: var(--navy-blue);
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }

        .search-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            align-items: end;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            color: var(--navy-blue);
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select {
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--accent-blue);
        }

        .btn {
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--accent-blue);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--navy-blue);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 116, 217, 0.4);
        }

        .btn-secondary {
            background: var(--light-navy);
            color: var(--white);
        }

        .btn-secondary:hover {
            background: var(--navy-blue);
        }

        /* Stats Section */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--white);
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-left: 4px solid var(--accent-blue);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            color: var(--navy-blue);
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .stat-card p {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        /* Flights Grid */
        .flights-section {
            background: var(--white);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .section-header h2 {
            color: var(--navy-blue);
            font-size: 1.5rem;
        }

        .filters {
            display: flex;
            gap: 1rem;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            border: 2px solid var(--accent-blue);
            background: transparent;
            color: var(--accent-blue);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-btn.active,
        .filter-btn:hover {
            background: var(--accent-blue);
            color: var(--white);
        }

        .flights-grid {
            display: grid;
            gap: 1.5rem;
        }

        .flight-card {
            background: linear-gradient(135deg, var(--light-gray) 0%, var(--white) 100%);
            border-radius: 12px;
            padding: 1.5rem;
            border: 2px solid transparent;
            transition: all 0.3s;
            cursor: pointer;
        }

        .flight-card:hover {
            border-color: var(--accent-blue);
            box-shadow: 0 6px 20px rgba(0, 116, 217, 0.2);
            transform: translateY(-2px);
        }

        .flight-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .airline-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .airline-logo {
            width: 50px;
            height: 50px;
            background: var(--navy-blue);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: bold;
            font-size: 1.2rem;
        }

        .airline-name {
            font-weight: 600;
            color: var(--navy-blue);
        }

        .flight-id {
            color: #7f8c8d;
            font-size: 0.9rem;
        }

        .price-tag {
            background: var(--accent-blue);
            color: var(--white);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 1.3rem;
            font-weight: bold;
        }

        .flight-route {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 1rem;
            align-items: center;
            margin: 1.5rem 0;
        }

        .airport {
            text-align: center;
        }

        .airport-code {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--navy-blue);
        }

        .airport-time {
            color: #7f8c8d;
            font-size: 0.9rem;
            margin-top: 0.3rem;
        }

        .flight-path {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--accent-blue);
        }

        .flight-duration {
            font-size: 0.8rem;
            margin-bottom: 0.5rem;
        }

        .path-line {
            width: 100%;
            height: 2px;
            background: var(--accent-blue);
            position: relative;
        }

        .path-line::after {
            content: '✈';
            position: absolute;
            right: -10px;
            top: -8px;
            font-size: 1.2rem;
        }

        .flight-details {
            display: flex;
            justify-content: space-around;
            padding-top: 1rem;
            border-top: 1px solid #e0e0e0;
        }

        .detail-item {
            text-align: center;
        }

        .detail-label {
            color: #7f8c8d;
            font-size: 0.8rem;
            margin-bottom: 0.3rem;
        }

        .detail-value {
            color: var(--navy-blue);
            font-weight: 600;
        }

        .badge {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-low {
            background: #d4edda;
            color: #155724;
        }

        .badge-medium {
            background: #fff3cd;
            color: #856404;
        }

        .badge-high {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-very_high {
            background: #d6d8db;
            color: #383d41;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--navy-blue);
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--accent-blue);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #7f8c8d;
        }

        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            border-radius: 15px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-header h2 {
            color: var(--navy-blue);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #7f8c8d;
        }

        /* Booking Form Styles */
        .booking-form {
            display: grid;
            gap: 1.5rem;
        }

        .form-section {
            background: var(--light-gray);
            padding: 1.5rem;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }

        .form-section h3 {
            color: var(--navy-blue);
            margin-bottom: 1rem;
            font-size: 1.2rem;
            border-bottom: 2px solid var(--accent-blue);
            padding-bottom: 0.5rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .form-row:last-child {
            margin-bottom: 0;
        }

        .form-field {
            display: flex;
            flex-direction: column;
        }

        .form-field label {
            color: var(--navy-blue);
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .form-field input,
        .form-field select {
            padding: 0.75rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-field input:focus,
        .form-field select:focus {
            outline: none;
            border-color: var(--accent-blue);
        }

        .form-field input.error {
            border-color: var(--danger);
        }

        .error-message {
            color: var(--danger);
            font-size: 0.8rem;
            margin-top: 0.3rem;
        }

        .test-info {
            background: #e8f4fd;
            border: 1px solid var(--accent-blue);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .test-info h4 {
            color: var(--navy-blue);
            margin-bottom: 0.5rem;
        }

        .test-info p {
            color: #666;
            font-size: 0.9rem;
            margin: 0.3rem 0;
        }

        .booking-summary {
            background: var(--white);
            border: 2px solid var(--accent-blue);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .booking-summary h3 {
            color: var(--navy-blue);
            margin-bottom: 1rem;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .summary-row.total {
            border-top: 2px solid var(--accent-blue);
            padding-top: 0.5rem;
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--navy-blue);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-menu {
                display: none;
            }

            .hero h1 {
                font-size: 1.8rem;
            }

            .search-form {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .flight-route {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .flight-path {
                transform: rotate(90deg);
            }
        }

        /* Animation */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body>
        <header class="header">
        <div class="header-content">
            <div class="logo">
                ✈️ <span>SkyBook</span> Airlines
            </div>
            <nav>
                <ul class="nav-menu">
                    <li><a onclick="showSection('home')">Home</a></li>
                    <li><a onclick="showSection('search')">Search Flights</a></li>
                    <li><a onclick="showSection('bookings')">My Bookings</a></li>
                    <li><a onclick="loadStats()">Statistics</a></li>
                    <li id="authButtons">
                        <a href="login.html">Login</a>
                        <a href="register.html">Register</a>
                    </li>
                    <li id="userInfo" style="display: none;">
                        <span style="color: var(--light-blue);">Welcome, </span>
                        <span id="userName" style="color: var(--white);"></span>
                        <a onclick="logout()" style="margin-left: 1rem; cursor: pointer;">Logout</a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>    <div class="container">
        <div class="hero fade-in">
            <h1>Find Your Perfect Flight ✈️</h1>
            <p>Experience dynamic pricing and real-time availability for the best deals</p>
        </div>

        <div class="search-card fade-in">
            <h2>🔍 Search Flights</h2>
            <form class="search-form" id="searchForm">
                <div class="form-group">
                    <label for="origin">From</label>
                    <select id="origin" required>
                        <option value="">Select Origin</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="destination">To</label>
                    <select id="destination" required>
                        <option value="">Select Destination</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="date">Departure Date</label>
                    <input type="date" id="date" required>
                </div>
                <div class="form-group">
                    <label for="sortBy">Sort By</label>
                    <select id="sortBy">
                        <option value="price">Price</option>
                        <option value="duration">Duration</option>
                    </select>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Search Flights</button>
                </div>
            </form>
        </div>

        <div class="stats-grid" id="statsGrid">
            </div>

        <div class="flights-section fade-in">
            <div class="section-header">
                <h2>🛫 Available Flights</h2>
                <div class="filters">
                    <button class="filter-btn active" onclick="filterFlights('all')">All</button>
                    <button class="filter-btn" onclick="filterFlights('economy')">Economy</button>
                    <button class="filter-btn" onclick="filterFlights('business')">Business</button>
                    <button class="filter-btn" onclick="filterFlights('premium')">Premium</button>
                </div>
            </div>
            <div id="flightsContainer">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading flights...</p>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="flightModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Flight Details</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div id="modalBody">
                </div>
        </div>
    </div>

    <!-- Booking Form Modal -->
    <div class="modal" id="bookingModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2>Complete Your Booking</h2>
                <button class="close-btn" onclick="closeBookingModal()">&times;</button>
            </div>
            <div id="bookingBody">
                <!-- Booking form will be loaded here -->
                </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_BASE_URL = 'http://localhost:8001';
        
        let allFlights = [];
        let currentFilter = 'all';

        // Check Authentication Status
        async function checkAuth() {
            const token = localStorage.getItem('authToken');
            const email = localStorage.getItem('userEmail');
            
            if (token && email) {
                // User is logged in
                document.getElementById('authButtons').style.display = 'none';
                document.getElementById('userInfo').style.display = 'block';
                
                // Fetch user details to display name
                try {
                    const response = await fetch(`${API_BASE_URL}/auth/user`, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    
                    if (response.ok) {
                        const user = await response.json();
                        document.getElementById('userName').textContent = `${user.first_name} ${user.last_name}`;
                    } else {
                        // If token is invalid, log out
                        logout();
                    }
                } catch (error) {
                    console.error('Error fetching user details:', error);
                    document.getElementById('userName').textContent = email;
                }
            } else {
                // User is not logged in
                document.getElementById('authButtons').style.display = 'block';
                document.getElementById('userInfo').style.display = 'none';
            }
        }

        // Logout function
        function logout() {
            localStorage.removeItem('authToken');
            localStorage.removeItem('userEmail');
            checkAuth();
            window.location.href = 'login.html';
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth(); // Check authentication status
            setMinDate();
            // Load airports first so selects are populated, then load flights/stats
            loadAirports().then(() => {
                loadAllFlights();
                loadStats();
            }).catch(err => {
                console.error('Failed to load airports:', err);
                // still try to load flights/stats
                loadAllFlights();
                loadStats();
            });
        });

        // Load airports from backend and populate origin/destination selects
        async function loadAirports() {
            try {
                const response = await fetch(`${API_BASE_URL}/airports`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const airports = await response.json();

                // Sort airports by code then city
                airports.sort((a, b) => (a.code > b.code ? 1 : -1));

                const originSelect = document.getElementById('origin');
                const destSelect = document.getElementById('destination');

                // Clear existing (keep placeholder)
                originSelect.querySelectorAll('option:not([value=""])').forEach(o => o.remove());
                destSelect.querySelectorAll('option:not([value=""])').forEach(o => o.remove());

                for (const ap of airports) {
                    const label = `${ap.code} - ${ap.city}, ${ap.country}`;
                    const opt1 = document.createElement('option');
                    opt1.value = ap.code;
                    opt1.textContent = label;
                    originSelect.appendChild(opt1);

                    const opt2 = document.createElement('option');
                    opt2.value = ap.code;
                    opt2.textContent = label;
                    destSelect.appendChild(opt2);
                }

                // Add change listeners to auto-trigger search when user changes values
                originSelect.addEventListener('change', autoSearchOnChange);
                destSelect.addEventListener('change', autoSearchOnChange);
                document.getElementById('date').addEventListener('change', autoSearchOnChange);

            } catch (err) {
                console.error('Error loading airports:', err);
                throw err;
            }
        }

        function autoSearchOnChange() {
            const origin = document.getElementById('origin').value;
            const destination = document.getElementById('destination').value;
            const date = document.getElementById('date').value;

            if (!origin || !destination || !date) return;
            if (origin === destination) return; // ignore invalid

            // Programmatically trigger the search form submit handler
            const form = document.getElementById('searchForm');
            // Use requestSubmit if available (preserves submit button logic), otherwise dispatch event
            if (typeof form.requestSubmit === 'function') {
                form.requestSubmit();
            } else {
                form.dispatchEvent(new Event('submit', { bubbles: true, cancelable: true }));
            }
        }

        // Set minimum date to today and max date to 7 days ahead
        function setMinDate() {
            const today = new Date();
            const maxDate = new Date(today);
            maxDate.setDate(today.getDate() + 7);
            
            const todayStr = today.toISOString().split('T')[0];
            const maxDateStr = maxDate.toISOString().split('T')[0];
            
            const dateInput = document.getElementById('date');
            dateInput.min = todayStr;
            dateInput.max = maxDateStr;
            dateInput.value = todayStr;
        }

        // Load all flights
        async function loadAllFlights() {
            showLoading();
            try {
                const response = await fetch(`${API_BASE_URL}/flights?limit=50`);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();
                allFlights = data;
                displayFlights(data);
            } catch (error) {
                console.error('Error loading flights:', error);
                showError('Failed to load flights. Please make sure the server is running.');
            }
        }

        // Load statistics
        async function loadStats() {
            try {
                const response = await fetch(`${API_BASE_URL}/stats`);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const stats = await response.json();
                displayStats(stats);
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Display statistics
        function displayStats(stats) {
            const statsGrid = document.getElementById('statsGrid');
            statsGrid.innerHTML = `
                <div class="stat-card fade-in">
                    <h3>${stats.total_flights}</h3>
                    <p>Total Flights</p>
                </div>
                <div class="stat-card fade-in">
                    <h3>${stats.total_bookings}</h3>
                    <p>Total Bookings</p>
                </div>
                <div class="stat-card fade-in">
                    <h3>${stats.airports}</h3>
                    <p>Airports</p>
                </div>
                <div class="stat-card fade-in">
                    <h3>${stats.occupancy_rate}</h3>
                    <p>Occupancy Rate</p>
                </div>
            `;
        }

        // Search flights
        document.getElementById('searchForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const origin = document.getElementById('origin').value;
            const destination = document.getElementById('destination').value;
            const date = document.getElementById('date').value;
            const sortBy = document.getElementById('sortBy').value;

            if (!origin || !destination || !date) {
                alert('Please fill in all fields');
                return;
            }

            if (origin === destination) {
                alert('Origin and destination cannot be the same');
                return;
            }

            showLoading();

            try {
                const response = await fetch(`${API_BASE_URL}/flights/search`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        origin,
                        destination,
                        date,
                        sort_by: sortBy
                    })
                });
                
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                const data = await response.json();
                allFlights = data;
                displayFlights(data);
            } catch (error) {
                console.error('Error searching flights:', error);
                showError('Failed to search flights');
            }
        });

        // Display flights
        function displayFlights(flights) {
            const container = document.getElementById('flightsContainer');
            
            if (flights.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"/>
                        </svg>
                        <h3>No flights found</h3>
                        <p>Try searching with different criteria</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = `
                <div class="flights-grid">
                    ${flights.map(flight => createFlightCard(flight)).join('')}
                </div>
            `;
        }

        // Create flight card
        function createFlightCard(flight) {
            const demandClass = `badge-${flight.demand_level}`;
            const airlineInitials = flight.airline.split(' ').map(w => w[0]).join('').substring(0, 2);
            
            return `
                <div class="flight-card fade-in" onclick="showFlightDetails('${flight.flight_id}')">
                    <div class="flight-header">
                        <div class="airline-info">
                            <div class="airline-logo">${airlineInitials}</div>
                            <div>
                                <div class="airline-name">${flight.airline}</div>
                                <div class="flight-id">${flight.flight_id}</div>
                            </div>
                        </div>
                        <div class="price-tag">$${flight.current_price}</div>
                    </div>
                    
                    <div class="flight-route">
                        <div class="airport">
                            <div class="airport-code">${flight.origin}</div>
                            <div class="airport-time">${flight.departure_time}</div>
                        </div>
                        
                        <div class="flight-path">
                            <div class="flight-duration">${flight.duration}</div>
                            <div class="path-line"></div>
                        </div>
                        
                        <div class="airport">
                            <div class="airport-code">${flight.destination}</div>
                            <div class="airport-time">${flight.arrival_time}</div>
                        </div>
                    </div>
                    
                    <div class="flight-details">
                        <div class="detail-item">
                            <div class="detail-label">Base Fare</div>
                            <div class="detail-value">$${flight.base_fare}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Available Seats</div>
                            <div class="detail-value">${flight.available_seats}/${flight.total_seats}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Class</div>
                            <div class="detail-value">${flight.tier.toUpperCase()}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Demand</div>
                            <div class="badge ${demandClass}">${flight.demand_level.replace('_', ' ').toUpperCase()}</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Filter flights
        function filterFlights(filter) {
            currentFilter = filter;
            
            // Update active button
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Filter flights
            let filtered = allFlights;
            if (filter !== 'all') {
                filtered = allFlights.filter(f => f.tier === filter);
            }
            
            displayFlights(filtered);
        }

        // Show flight details
        async function showFlightDetails(flightId) {
            try {
                const response = await fetch(`${API_BASE_URL}/flights/${flightId}`);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const flight = await response.json();
                
                const modalBody = document.getElementById('modalBody');
                const demandClass = `badge-${flight.demand_level}`;
                
                modalBody.innerHTML = `
                    <div style="padding: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                            <div>
                                <h3 style="color: var(--navy-blue); margin-bottom: 0.5rem;">${flight.airline}</h3>
                                <p style="color: #7f8c8d;">${flight.flight_id}</p>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 2rem; font-weight: bold; color: var(--accent-blue);">$${flight.current_price}</div>
                                <div style="font-size: 0.9rem; color: #7f8c8d;">Base: $${flight.base_fare}</div>
                            </div>
                        </div>

                        <div style="background: var(--light-gray); padding: 1.5rem; border-radius: 10px; margin-bottom: 1.5rem;">
                            <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 1rem; align-items: center; text-align: center;">
                                <div class="airport">
                                    <div style="font-size: 2rem; font-weight: bold; color: var(--navy-blue);">${flight.origin}</div>
                                    <div style="color: #7f8c8d; margin-top: 0.5rem;">${flight.departure_time}</div>
                                </div>
                                
                                <div class="flight-path">
                                    <div style="color: var(--accent-blue); font-size: 0.9rem; margin-bottom: 0.5rem;">${flight.duration}</div>
                                    <div style="width: 100px; height: 2px; background: var(--accent-blue); position: relative;">
                                        <span style="position: absolute; right: -10px; top: -8px; font-size: 1.2rem;">✈</span>
                                    </div>
                                </div>
                                
                                <div class="airport">
                                    <div style="font-size: 2rem; font-weight: bold; color: var(--navy-blue);">${flight.destination}</div>
                                    <div style="color: #7f8c8d; margin-top: 0.5rem;">${flight.arrival_time}</div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                            <div style="background: white; padding: 1rem; border-radius: 8px; border: 2px solid #e0e0e0;">
                                <div style="color: #7f8c8d; font-size: 0.9rem; margin-bottom: 0.5rem;">Available Seats</div>
                                <div style="font-size: 1.5rem; font-weight: bold; color: var(--navy-blue);">${flight.available_seats} / ${flight.total_seats}</div>
                            </div>
                            
                            <div style="background: white; padding: 1rem; border-radius: 8px; border: 2px solid #e0e0e0;">
                                <div style="color: #7f8c8d; font-size: 0.9rem; margin-bottom: 0.5rem;">Class</div>
                                <div style="font-size: 1.5rem; font-weight: bold; color: var(--navy-blue); text-transform: capitalize;">${flight.tier}</div>
                            </div>
                            
                            <div style="background: white; padding: 1rem; border-radius: 8px; border: 2px solid #e0e0e0;">
                                <div style="color: #7f8c8d; font-size: 0.9rem; margin-bottom: 0.5rem;">Demand Level</div>
                                <div><span class="badge ${demandClass}">${flight.demand_level.replace('_', ' ').toUpperCase()}</span></div>
                            </div>
                            
                            <div style="background: white; padding: 1rem; border-radius: 8px; border: 2px solid #e0e0e0;">
                                <div style="color: #7f8c8d; font-size: 0.9rem; margin-bottom: 0.5rem;">Duration</div>
                                <div style="font-size: 1.5rem; font-weight: bold; color: var(--navy-blue);">${flight.duration}</div>
                            </div>
                        </div>     
                        <button class="btn btn-primary" style="width: 100%; padding: 1rem; font-size: 1.1rem;" onclick="bookFlight('${flight.flight_id}')">
                            Book Now for $${flight.current_price}
                        </button>
                    </div>
                `;
                
                document.getElementById('flightModal').classList.add('active');
                
            } catch (error) {
                console.error('Error fetching flight details:', error);
                alert('Failed to load flight details.');
            }
        }

        // Book flight - Show booking form
        async function bookFlight(flightId) {
            const token = localStorage.getItem('authToken');
            if (!token) {
                // Store the current URL to return after login
                localStorage.setItem('returnUrl', window.location.href);
                window.location.href = 'login.html';
                return;
            }

            // Get flight details
            try {
                const response = await fetch(`${API_BASE_URL}/flights/${flightId}`);
                if (!response.ok) throw new Error('Failed to fetch flight details');
                
                const flight = await response.json();
                showBookingForm(flight);
                
            } catch (error) {
                console.error('Error fetching flight details:', error);
                alert('Failed to load flight details for booking.');
            }
        }

        // Show booking form
        async function showBookingForm(flight) {
            const token = localStorage.getItem('authToken');
            const userEmail = localStorage.getItem('userEmail');
            
            if (!token || !userEmail) {
                window.location.href = 'login.html';
                return;
            }
            
            // Get user info if available
            let userInfo = null;
            try {
                const response = await fetch(`${API_BASE_URL}/auth/user`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.ok) {
                    userInfo = await response.json();
                }
            } catch (error) {
                console.error('Error fetching user info:', error);
            }
            
            const bookingBody = document.getElementById('bookingBody');
            
            bookingBody.innerHTML = `
                <form class="booking-form" id="bookingForm">
                    <!-- Booking Summary -->
                    <div class="booking-summary">
                        <h3>Booking Summary</h3>
                        <div class="summary-row">
                            <span>Flight:</span>
                            <span>${flight.flight_id} - ${flight.airline}</span>
                        </div>
                        <div class="summary-row">
                            <span>Route:</span>
                            <span>${flight.origin} → ${flight.destination}</span>
                        </div>
                        <div class="summary-row">
                            <span>Departure:</span>
                            <span>${flight.departure_time}</span>
                        </div>
                        <div class="summary-row">
                            <span>Duration:</span>
                            <span>${flight.duration}</span>
                        </div>
                        <div class="summary-row">
                            <span>Class:</span>
                            <span>${flight.tier.toUpperCase()}</span>
                        </div>
                        <div class="summary-row total">
                            <span>Total Amount:</span>
                            <span>$${flight.current_price}</span>
                        </div>
                    </div>

                    <!-- Passenger Information -->
                    <div class="form-section">
                        <h3>👤 Passenger Information</h3>
                        <div class="form-row">
                            <div class="form-field">
                                <label for="firstName">First Name *</label>
                                <input type="text" id="firstName" name="firstName" value="${userInfo?.first_name || ''}" required>
                            </div>
                            <div class="form-field">
                                <label for="lastName">Last Name *</label>
                                <input type="text" id="lastName" name="lastName" value="${userInfo?.last_name || ''}" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-field">
                                <label for="email">Email Address *</label>
                                <input type="email" id="email" name="email" value="${userEmail}" readonly required>
                                <small style="color: #666;">Email address is locked to your account email</small>
                            </div>
                            <div class="form-field">
                                <label for="phone">Phone Number *</label>
                                <input type="tel" id="phone" name="phone" value="${userInfo?.phone || ''}" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-field">
                                <label for="passport">Passport Number (Optional)</label>
                                <input type="text" id="passport" name="passport">
                            </div>
                            <div class="form-field">
                                <label for="seatPreference">Seat Preference</label>
                                <select id="seatPreference" name="seatPreference">
                                    <option value="">No preference</option>
                                    <option value="window">Window</option>
                                    <option value="aisle">Aisle</option>
                                    <option value="middle">Middle</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Information -->
                    <div class="form-section">
                        <h3>💳 Payment Information</h3>
                        <div class="form-row">
                            <div class="form-field">
                                <label for="cardNumber">Card Number *</label>
                                <input type="text" id="cardNumber" name="cardNumber" placeholder="1234 5678 9012 3456" required>
                            </div>
                            <div class="form-field">
                                <label for="cardHolder">Cardholder Name *</label>
                                <input type="text" id="cardHolder" name="cardHolder" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-field">
                                <label for="expiryMonth">Expiry Month *</label>
                                <select id="expiryMonth" name="expiryMonth" required>
                                    <option value="">Month</option>
                                    <option value="1">01</option>
                                    <option value="2">02</option>
                                    <option value="3">03</option>
                                    <option value="4">04</option>
                                    <option value="5">05</option>
                                    <option value="6">06</option>
                                    <option value="7">07</option>
                                    <option value="8">08</option>
                                    <option value="9">09</option>
                                    <option value="10">10</option>
                                    <option value="11">11</option>
                                    <option value="12">12</option>
                                </select>
                            </div>
                            <div class="form-field">
                                <label for="expiryYear">Expiry Year *</label>
                                <select id="expiryYear" name="expiryYear" required>
                                    <option value="">Year</option>
                                    <option value="2024">2024</option>
                                    <option value="2025">2025</option>
                                    <option value="2026">2026</option>
                                    <option value="2027">2027</option>
                                    <option value="2028">2028</option>
                                    <option value="2029">2029</option>
                                    <option value="2030">2030</option>
                                </select>
                            </div>
                            <div class="form-field">
                                <label for="cvv">CVV *</label>
                                <input type="text" id="cvv" name="cvv" placeholder="123" maxlength="4" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-field" style="grid-column: 1 / -1;">
                                <label for="billingAddress">Billing Address *</label>
                                <input type="text" id="billingAddress" name="billingAddress" placeholder="123 Main St, City, State, ZIP" required>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div style="text-align: center; margin-top: 2rem;">
                        <button type="submit" class="btn btn-primary" style="padding: 1rem 3rem; font-size: 1.1rem;">
                            Complete Booking - $${flight.current_price}
                        </button>
                    </div>
                </form>
            `;
            
            // Store flight data for form submission
            window.currentBookingFlight = flight;
            
            // Show the booking modal
            document.getElementById('bookingModal').classList.add('active');
            
            // Add form submission handler
            document.getElementById('bookingForm').addEventListener('submit', handleBookingSubmission);
        }

        // Handle booking form submission
        async function handleBookingSubmission(e) {
            e.preventDefault();
            
            const token = localStorage.getItem('authToken');
            const userEmail = localStorage.getItem('userEmail');
            
            if (!token || !userEmail) {
                window.location.href = 'login.html';
                return;
            }
            
            const form = e.target;
            const formData = new FormData(form);
            
            // Validate form
            if (!validateBookingForm(formData)) {
                return;
            }
            
            // Verify email matches logged in user
            if (formData.get('email') !== userEmail) {
                alert('Please use the same email address that you used to log in.');
                return;
            }
            
            // Prepare booking data
            const bookingData = {
                flight_id: window.currentBookingFlight.flight_id,
                passenger: {
                    first_name: formData.get('firstName'),
                    last_name: formData.get('lastName'),
                    email: formData.get('email'),
                    phone: formData.get('phone'),
                    passport_number: formData.get('passport') || null
                },
                payment: {
                    card_number: formData.get('cardNumber').replace(/\s/g, ''),
                    card_holder_name: formData.get('cardHolder'),
                    expiry_month: parseInt(formData.get('expiryMonth')),
                    expiry_year: parseInt(formData.get('expiryYear')),
                    cvv: formData.get('cvv'),
                    billing_address: formData.get('billingAddress')
                },
                seat_preference: formData.get('seatPreference') || null
            };
            
            try {
                // Show loading state
                const submitBtn = form.querySelector('button[type="submit"]');
                const originalText = submitBtn.textContent;
                submitBtn.textContent = 'Processing...';
                submitBtn.disabled = true;
                
                const response = await fetch(`${API_BASE_URL}/flights/book`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}` 
                    },
                    body: JSON.stringify(bookingData)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'Booking failed');
                }

                const booking = await response.json();
                
                // Show success message
                showBookingConfirmation(booking);
                closeBookingModal();
                closeModal(); // Close flight details modal too
                loadAllFlights(); // Refresh flights to show new seat count

            } catch (error) {
                console.error('Error booking flight:', error);
                alert(`Booking failed: ${error.message}`);
                
                // Reset button
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.textContent = `Complete Booking - $${window.currentBookingFlight.current_price}`;
                submitBtn.disabled = false;
            }
        }

        // Validate booking form
        function validateBookingForm(formData) {
            const requiredFields = ['firstName', 'lastName', 'email', 'phone', 'cardNumber', 'cardHolder', 'expiryMonth', 'expiryYear', 'cvv', 'billingAddress'];
            
            for (const field of requiredFields) {
                if (!formData.get(field)) {
                    alert(`Please fill in the ${field.replace(/([A-Z])/g, ' $1').toLowerCase()} field.`);
                    return false;
                }
            }
            
            // Validate email
            const email = formData.get('email');
            if (!email.includes('@')) {
                alert('Please enter a valid email address.');
                return false;
            }
            
            // Validate card number
            const cardNumber = formData.get('cardNumber').replace(/\s/g, '');
            if (cardNumber.length < 13 || cardNumber.length > 19) {
                alert('Please enter a valid card number.');
                return false;
            }
            
            // Validate CVV
            const cvv = formData.get('cvv');
            if (cvv.length < 3 || cvv.length > 4) {
                alert('Please enter a valid CVV.');
                return false;
            }
            
            return true;
        }

        // Close booking modal
        function closeBookingModal() {
            document.getElementById('bookingModal').classList.remove('active');
            window.currentBookingFlight = null;
        }


        // Show booking confirmation
        function showBookingConfirmation(booking) {
            alert(`🎉 Booking Successful!\n\n` +
                  `Booking ID: ${booking.booking_id}\n` +
                  `Confirmation Code: ${booking.confirmation_code}\n` +
                  `Passenger: ${booking.passenger_name}\n` +
                  `Flight: ${booking.flight_id}\n` +
                  `Total Amount: $${booking.total_amount}\n` +
                  `Status: ${booking.booking_status}\n\n` +
                  `A confirmation email has been sent to ${booking.email}`);
        }

        // Close modal
        function closeModal() {
            document.getElementById('flightModal').classList.remove('active');
        }

        // Show/hide sections
        function showSection(section) {
            console.log(`Navigating to ${section}...`);
            if (section === 'home') {
                // Show home page - reload all flights
                loadAllFlights();
                loadStats();
                // Scroll to top
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else if (section === 'search') {
                document.getElementById('searchForm').scrollIntoView({ behavior: 'smooth' });
            } else if (section === 'bookings') {
                showMyBookings();
            }
        }

        // Show my bookings
        async function showMyBookings() {
            const token = localStorage.getItem('authToken');
            const email = localStorage.getItem('userEmail');
            
            if (!token || !email) {
                window.location.href = 'login.html';
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/bookings/email/${encodeURIComponent(email)}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.status === 401) {
                    // Token expired or invalid
                    localStorage.removeItem('authToken');
                    localStorage.removeItem('userEmail');
                    window.location.href = 'login.html';
                    return;
                }
                
                if (!response.ok) {
                    throw new Error('Failed to fetch bookings');
                }
                
                const data = await response.json();
                displayBookings(data);
                
            } catch (error) {
                console.error('Error fetching bookings:', error);
                alert('Failed to load bookings. Please try again.');
            }
        }

        // Display bookings
        function displayBookings(bookingsData) {
            const container = document.getElementById('flightsContainer');
            
            if (bookingsData.bookings.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>No bookings found</h3>
                        <p>No bookings found for ${bookingsData.email}</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <div class="flights-grid">
                    ${bookingsData.bookings.map(booking => createBookingCard(booking)).join('')}
                </div>
            `;
        }

        // Create booking card
        function createBookingCard(booking) {
            const statusClass = booking.booking_status === 'confirmed' ? 'badge-success' : 'badge-danger';
            
            return `
                <div class="flight-card fade-in">
                    <div class="flight-header">
                        <div class="airline-info">
                            <div class="airline-logo">BK</div>
                            <div>
                                <div class="airline-name">Booking Details</div>
                                <div class="flight-id">${booking.booking_id}</div>
                            </div>
                        </div>
                        <div class="price-tag">$${booking.total_amount}</div>
                    </div>
                    
                    <div class="flight-details">
                        <div class="detail-item">
                            <div class="detail-label">Passenger</div>
                            <div class="detail-value">${booking.passenger.first_name} ${booking.passenger.last_name}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Flight ID</div>
                            <div class="detail-value">${booking.flight_id}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Status</div>
                            <div class="badge ${statusClass}">${booking.booking_status.toUpperCase()}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">Confirmation</div>
                            <div class="detail-value">${booking.confirmation_code}</div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 1rem; text-align: center;">
                        <button class="btn btn-secondary" onclick="viewBookingDetails('${booking.booking_id}')">
                            View Details
                        </button>
                        ${booking.booking_status === 'confirmed' ? 
                            `<button class="btn btn-danger" onclick="cancelBooking('${booking.booking_id}')" style="margin-left: 0.5rem;">
                                Cancel Booking
                            </button>` : ''
                        }
                    </div>
                </div>
            `;
        }

        // View booking details
        async function viewBookingDetails(bookingId) {
            try {
                const token = localStorage.getItem('authToken');
                if (!token) {
                    window.location.href = 'login.html';
                    return;
                }

                const response = await fetch(`${API_BASE_URL}/bookings/${bookingId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                if (response.status === 401) {
                    localStorage.removeItem('authToken');
                    localStorage.removeItem('userEmail');
                    window.location.href = 'login.html';
                    return;
                }
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'Failed to fetch booking details');
                }
                
                const data = await response.json();
                const booking = data.booking;
                
                const modalBody = document.getElementById('modalBody');
                modalBody.innerHTML = `
                    <div style="padding: 1rem;">
                        <h3 style="color: var(--navy-blue); margin-bottom: 1rem;">Booking Details</h3>
                        
                        <div style="background: var(--light-gray); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <h4>Booking Information</h4>
                            <p><strong>Booking ID:</strong> ${booking.booking_id}</p>
                            <p><strong>Confirmation Code:</strong> ${booking.confirmation_code}</p>
                            <p><strong>Status:</strong> ${booking.booking_status}</p>
                            <p><strong>Booking Date:</strong> ${booking.booking_date}</p>
                            <p><strong>Total Amount:</strong> $${booking.total_amount}</p>
                        </div>
                        
                        <div style="background: var(--light-gray); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                            <h4>Passenger Information</h4>
                            <p><strong>Name:</strong> ${booking.passenger.first_name} ${booking.passenger.last_name}</p>
                            <p><strong>Email:</strong> ${booking.passenger.email}</p>
                            <p><strong>Phone:</strong> ${booking.passenger.phone}</p>
                            ${booking.passenger.passport_number ? `<p><strong>Passport:</strong> ${booking.passenger.passport_number}</p>` : ''}
                        </div>
                        
                        <div style="background: var(--light-gray); padding: 1rem; border-radius: 8px;">
                            <h4>Flight Information</h4>
                            <p><strong>Flight ID:</strong> ${booking.flight_id}</p>
                            <p><strong>Seat Preference:</strong> ${booking.seat_preference || 'None specified'}</p>
                        </div>
                    </div>
                `;
                
                document.getElementById('flightModal').classList.add('active');
                
            } catch (error) {
                console.error('Error fetching booking details:', error);
                alert('Failed to load booking details.');
            }
        }

        // Cancel booking
        async function cancelBooking(bookingId) {
            if (!confirm('Are you sure you want to cancel this booking?')) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/bookings/${bookingId}`, {
                    method: 'DELETE'
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'Cancellation failed');
                }
                
                alert('Booking cancelled successfully!');
                showMyBookings(); // Refresh bookings
                
            } catch (error) {
                console.error('Error cancelling booking:', error);
                alert(`Cancellation failed: ${error.message}`);
            }
        }

        // Show loading state
        function showLoading() {
            document.getElementById('flightsContainer').innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading flights...</p>
                </div>
            `;
        }

        // Show error state
        function showError(message) {
            document.getElementById('flightsContainer').innerHTML = `
                <div class="empty-state">
                    <h3>Error</h3>
                    <p>${message}</p>
                </div>
            `;
        }

        // Close modal on outside click
        document.getElementById('flightModal').addEventListener('click', (e) => {
            if (e.target.id === 'flightModal') {
                closeModal();
            }
        });

        // Close booking modal on outside click
        document.getElementById('bookingModal').addEventListener('click', (e) => {
            if (e.target.id === 'bookingModal') {
                closeBookingModal();
            }
        });

    </script>
</body>
</html>